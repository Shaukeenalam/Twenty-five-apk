#:import hex kivy.utils.get_color_from_hex
#:import Window kivy.core.window.Window

<StockListItem>:
    theme_bg_color: "Custom"
    bg_color: hex(app.color_palette["background"])
    radius: dp(10)
    padding: dp(10)
    height: dp(60)
    size_hint_y: None
    size_hint_x: 1
        
    MDIconButton:
        icon: "close"
        theme_text_color: "Custom"
        text_color: hex(app.color_palette["secondary"])
        pos_hint: {'right': 0.95, 'center_y': 0.5}
        size_hint: (None, None)
        size: (dp(40), dp(40))
        on_release: app.remove_stock(root)
        
<CredentialsInputScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(15)
        md_bg_color: hex(app.color_palette["background"])
        size_hint: (1, None)
        height: self.minimum_height
        pos_hint: {"top": 1}
        
        # Header
        MDBoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: dp(80)
            padding: [dp(10), dp(10), dp(70), dp(10)]
            md_bg_color: hex(app.color_palette["primary"])
            radius: [dp(10), dp(10), 0, 0]
            spacing: dp(5)
            size_hint_x: 1
                
            ClickableImage:
                source: "data/TFlogo.png" if app.has_logo else ""
                size_hint_x: None
                width: dp(50)
                pos_hint: {"center_y": 0.5}
                
            MDLabel:
                text: "TWENTYFIVE"
                font_style: "H4"
                halign: "center"
                theme_text_color: "Custom"
                text_color: hex(app.color_palette["text_light"])
                bold: True
                size_hint_x: 0.8
                
            MDFloatingActionButton:
                icon: "arrow-left"
                pos_hint: {"center_y": 0.5}
                on_release: root.go_back()
                md_bg_color: hex(app.color_palette["secondary"])
                theme_text_color: "Custom"
                text_color: hex(app.color_palette["text_light"])
                elevation_normal: 8
                size_hint: (None, None)
                size: (dp(48), dp(48))
                x: Window.width - dp(70)
                
        # Form Content
        MDLabel:
            text: "Credentials Configuration"
            halign: "center"
            font_style: "H5"
            size_hint_y: None
            height: dp(48)
            theme_text_color: "Custom"
            text_color: hex(app.color_palette["primary"])
            bold: True
        MDCard:
            orientation: "vertical"
            spacing: dp(15)
            padding: dp(25)
            size_hint: (1, None)
            height: self.minimum_height
            elevation: 2
            radius: dp(15)
            md_bg_color: hex(app.color_palette["background"])
            
            MDTextField:
                id: username_field
                hint_text: "Username"
                mode: "rectangle"
                size_hint_x: 1
                font_size: dp(16)
                line_color_normal: hex(app.color_palette["primary"])
                line_color_focus: hex(app.color_palette["secondary"])
                size_hint_y: None
                height: dp(60)
            MDTextField:
                id: pin_field
                hint_text: "PIN"
                password: True
                mode: "rectangle"
                size_hint_x: 1
                font_size: dp(16)
                line_color_normal: hex(app.color_palette["primary"])
                line_color_focus: hex(app.color_palette["secondary"])
                size_hint_y: None
                height: dp(60)
            MDTextField:
                id: api_key_field
                hint_text: "API Key"
                mode: "rectangle"
                size_hint_x: 1
                font_size: dp(16)
                line_color_normal: hex(app.color_palette["primary"])
                line_color_focus: hex(app.color_palette["secondary"])
                size_hint_y: None
                height: dp(60)
            MDTextField:
                id: token_field
                hint_text: "Token"
                mode: "rectangle"
                size_hint_x: 1
                font_size: dp(16)
                line_color_normal: hex(app.color_palette["primary"])
                line_color_focus: hex(app.color_palette["secondary"])
                size_hint_y: None
                height: dp(60)
            
            MDTextField:
                id: quantity_field
                hint_text: "Quantity"
                mode: "rectangle"
                size_hint_x: 1
                font_size: dp(16)
                line_color_normal: hex(app.color_palette["primary"])
                line_color_focus: hex(app.color_palette["secondary"])
                size_hint_y: None
                height: dp(60)
        # Action Buttons
        MDBoxLayout:
            orientation: "horizontal"
            spacing: dp(20)
            size_hint: (1, None)
            height: dp(60)
            padding: [0, dp(10), 0, 0]
            MDRaisedButton:
                id: save_btn
                text: "SAVE"
                size_hint_x: 0.5
                font_size: dp(16)
                md_bg_color: hex(app.color_palette["primary"])
                theme_text_color: "Custom"
                text_color: hex(app.color_palette["text_light"])
                on_release: root.save_credentials()
                size_hint_y: None
                height: dp(50)
            MDRaisedButton:
                id: toggle_btn
                text: "ACTIVE" if root.is_active else "INACTIVE"
                size_hint_x: 0.5
                md_bg_color: hex(app.color_palette["secondary"])
                theme_text_color: "Custom"
                text_color: hex(app.color_palette["text_light"])
                font_size: dp(16)
                on_release: root.toggle_active()
                size_hint_y: None
                height: dp(50)
        # Status Label
        MDLabel:
            id: status_label
            text: ""
            halign: "center"
            theme_text_color: "Custom"
            text_color: hex(app.color_palette["surface"])
            size_hint_y: None
            height: dp(30)
            font_style: "Caption"

<MainScreen>:
    MDBoxLayout:
        orientation: "vertical"
        spacing: dp(20)
        padding: dp(15)
        md_bg_color: hex(app.color_palette["background"])
        size_hint: (1, None)
        height: self.minimum_height
        pos_hint: {"top": 1}
        
        # Header with integrated FAB
        MDBoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: dp(80)
            padding: [dp(10), dp(10), dp(70), dp(10)]
            md_bg_color: hex(app.color_palette["primary"])
            radius: [dp(10), dp(10), 0, 0]
            spacing: dp(5)
            size_hint_x: 1
            
            ClickableImage:
                source: "data/TFlogo.png" if app.has_logo else ""
                size_hint_x: None
                width: dp(50)
                pos_hint: {"center_y": 0.5}
            MDLabel:
                text: "TWENTYFIVE"
                font_style: "H4"
                halign: "left"
                theme_text_color: "Custom"
                bold: True
                size_hint_x: 0.8
                text_color: hex(app.color_palette["text_light"])
                
            MDFloatingActionButton:
                icon: "cog"
                pos_hint: {"center_y": 0.5}
                on_release: app.navigate_to_credentials()
                md_bg_color: hex(app.color_palette["secondary"])
                theme_text_color: "Custom"
                text_color: hex(app.color_palette["text_light"])
                elevation_normal: 8
                size_hint: (None, None)
                size: (dp(48), dp(48))
                x: Window.width - dp(70)

                
        # Search Section
        MDCard:
            orientation: "vertical"
            spacing: dp(15)
            padding: dp(20)
            size_hint_y: None
            height: self.minimum_height
            elevation: 2
            radius: dp(15)
            md_bg_color: hex(app.color_palette["background"])
            size_hint_x: 1
            MDTextField:
                id: search_field
                hint_text: "Search stock symbol (e.g., MARUTI)"
                mode: "rectangle"
                size_hint_y: None
                height: dp(48)
                line_color_normal: hex(app.color_palette["primary"])
                line_color_focus: hex(app.color_palette["secondary"])
                on_text_validate: app.search_stock()
                size_hint_x: 1
            MDRaisedButton:
                text: "SEARCH"
                size_hint_y: None
                height: dp(48)
                on_release: app.search_stock()
                md_bg_color: hex(app.color_palette["primary"])
                theme_text_color: "Custom"
                text_color: hex(app.color_palette["text_light"])
                size_hint_x: 1
            MDBoxLayout:
                orientation: "vertical"
                spacing: dp(10)
                size_hint_y: None
                height: self.minimum_height
                id: search_result_box
                size_hint_x: 1
                MDLabel:
                    id: search_result_symbol
                    text: ""
                    font_style: "H6"
                    halign: "center"
                    theme_text_color: "Custom"
                    text_color: hex(app.color_palette["surface"])
                    size_hint_y: None
                    height: dp(40)
                MDLabel:
                    id: search_result_name
                    text: ""
                    halign: "center"
                    theme_text_color: "Custom"
                    text_color: hex(app.color_palette["surface"])
                    size_hint_y: None
                    height: dp(40)
                MDRaisedButton:
                    id: add_button
                    text: "ADD TO WATCHLIST"
                    size_hint_y: None
                    height: dp(48)
                    on_release: app.add_to_watchlist()
                    md_bg_color: hex(app.color_palette["secondary"])
                    theme_text_color: "Custom"
                    text_color: hex(app.color_palette["text_light"])
                    size_hint_x: 1
        # Watchlist Section
        MDCard:
            orientation: "vertical"
            padding: dp(15)
            spacing: dp(10)
            elevation: 2
            radius: dp(15)
            md_bg_color: hex(app.color_palette["background"])
            size_hint_y: None
            height: dp(300) if Window.height > 600 else dp(250)
            size_hint_x: 1
            
            MDLabel:
                text: "Watchlist"
                font_style: "H6"
                halign: "center"
                size_hint_y: None
                height: dp(40)
                theme_text_color: "Custom"
                text_color: hex(app.color_palette["primary"])
            
            ScrollView:
                size_hint_y: 1
                bar_width: dp(8)
                bar_color: hex(app.color_palette["primary"])
                bar_inactive_color: hex(app.color_palette["secondary"])
                effect_cls: "ScrollEffect"
                
                MDList:
                    id: watchlist
                    spacing: dp(10)
                    padding: dp(5)
                    size_hint_y: None
                    height: self.minimum_height
<FirstScreen>:
    MDBoxLayout:
        orientation: 'vertical'
        padding: dp(20)
        spacing: dp(20)
        md_bg_color: hex(app.color_palette["background"])
        size_hint: (1, 1)

        BoxLayout:
            size_hint_y: 0.3

        AnimatedLabel:
            id: main_label
            text: 'TWENTY FIVE'
            color: hex(app.color_palette["primary"])
            bold: True
            halign: 'center'
            anim_font_size: 0
            anim_opacity: 0
            size_hint_y: None
            height: dp(80)

        BoxLayout:
            size_hint_y: 0.2

        AnimatedLabel:
            id: sha_label
            text: '[color={}]Shauk[/color][color={}]e[/color][color={}]e[/color][color={}]n Group[/color]'.format(app.color_palette["surface"], app.color_palette["secondary"], app.color_palette["primary"], app.color_palette["surface"])
            bold: True
            markup: True
            halign: 'center'
            anim_font_size: 0
            anim_opacity: 0
            size_hint_y: None
            height: dp(50)

        BoxLayout:
            size_hint_y: 0.3

ScreenManager:
    FirstScreen:
        name: "first"
    
    MainScreen:
        name: "main"
    
    CredentialsInputScreen:
        name: "credentials_input"